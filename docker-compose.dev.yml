# Docker Compose 開發環境配置
# Resume Management System - 開發環境
# 用途: 本地開發,使用非特權端口避免權限問題
# 建立日期: 2025-01-12
#
# 使用方式:
#   docker-compose -f docker-compose.dev.yml up -d --build
#
# 與生產環境差異:
#   1. 前端端口: 8000 (非特權端口,不需要 sudo)
#   2. 後端端口: 8001 (非特權端口,避免 WSL2 衝突)
#   3. 支援熱重載 (需取消註解 volumes)
#   4. 資料庫掛載便於開發除錯

# version: '3.8'

services:
  # 後端服務 - 開發模式
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: resumexlab-backend-dev
    restart: unless-stopped
    ports:
      # 開發環境: 使用非特權端口
      - "8001:8000"
    environment:
      # API 設定
      - PROJECT_NAME=Resume Management System (Development)
      - VERSION=1.0.0-dev
      - API_V1_STR=/api

      # 資料庫設定 (SQLite)
      - DATABASE_URL=sqlite:///./data/resume.db

      # JWT 設定
      - SECRET_KEY=dev-secret-key-for-testing-only
      - ALGORITHM=HS256
      - ACCESS_TOKEN_EXPIRE_MINUTES=1440

      # CORS 設定 - 開發環境
      - BACKEND_CORS_ORIGINS=["http://localhost:8000", "http://localhost:3000", "http://localhost:8080", "http://localhost"]
    volumes:
      # 掛載資料庫文件
      - ./backend/data:/app/data
      # 開發模式: 掛載程式碼以支援熱重載 (需重啟容器)
      # - ./backend/app:/app/app
    networks:
      - resumexlab-dev-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # 前端服務 - 開發模式
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: resumexlab-frontend-dev
    restart: unless-stopped
    ports:
      # 開發環境: 使用非特權端口
      - "8000:80"
    networks:
      - resumexlab-dev-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# 開發環境網路
networks:
  resumexlab-dev-network:
    driver: bridge
