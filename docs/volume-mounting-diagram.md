# Docker Volume æ›è¼‰åŸç†åœ–è§£

## ğŸ“Š Volume æ›è¼‰æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Host Machine                          â”‚
â”‚                      (ä½ çš„é›»è…¦/ä¼ºæœå™¨)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  resumexlab/                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ backend/                                          â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ data/           â† æŒä¹…åŒ–ç›®éŒ„ (è³‡æ–™åº«)         â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ resume.db   â† æ°¸ä¹…ä¿å­˜                   â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ uploads/        â† æŒä¹…åŒ–ç›®éŒ„ (ä¸Šå‚³æ–‡ä»¶) â­    â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ file.pdf    â† æ°¸ä¹…ä¿å­˜                   â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ app/                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†•                                 â”‚
â”‚                     Volume Mount                             â”‚
â”‚                   (docker-compose.yml)                       â”‚
â”‚                            â†•                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Docker Container: resumexlab-backend           â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  /app/                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ data/         â† æ›è¼‰è‡ª ./backend/data            â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ resume.db                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ uploads/      â† æ›è¼‰è‡ª ./backend/uploads â­       â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ file.pdf                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ app/          â† å®¹å™¨å…§æ‡‰ç”¨ç¨‹å¼ç¢¼                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€ main.py                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•¸æ“šæµå‹•éç¨‹

### å ´æ™¯ 1: ç”¨æˆ¶ä¸Šå‚³æ–‡ä»¶

```
1. ç”¨æˆ¶é€šéå‰ç«¯ä¸Šå‚³æ–‡ä»¶
   â”‚
   â†“
2. FastAPI æ¥æ”¶æ–‡ä»¶ï¼Œä¿å­˜åˆ°å®¹å™¨å…§ /app/uploads/file.pdf
   â”‚
   â†“
3. Docker Volume åŒæ­¥åˆ°ä¸»æ©Ÿ ./backend/uploads/file.pdf
   â”‚
   â†“
4. æ–‡ä»¶åŒæ™‚å­˜åœ¨æ–¼ï¼š
   - å®¹å™¨: /app/uploads/file.pdf (é‹è¡Œæ™‚è¨ªå•)
   - ä¸»æ©Ÿ: ./backend/uploads/file.pdf (æŒä¹…åŒ–å­˜å„²)
```

### å ´æ™¯ 2: docker-compose down

```
åŸ·è¡Œå‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host           â”‚          â”‚  Container      â”‚
â”‚  ./backend/     â”‚  â†â”€â”€â”€â†’   â”‚  /app/          â”‚
â”‚    uploads/     â”‚          â”‚    uploads/     â”‚
â”‚      file.pdf   â”‚          â”‚      file.pdf   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        âœ“                            âœ“

åŸ·è¡Œå¾Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host           â”‚
â”‚  ./backend/     â”‚          Container å·²åˆªé™¤
â”‚    uploads/     â”‚
â”‚      file.pdf   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        âœ“

çµæœ: æ–‡ä»¶ä¿ç•™åœ¨ä¸»æ©Ÿï¼
```

### å ´æ™¯ 3: docker-compose upï¼ˆé‡æ–°å•Ÿå‹•ï¼‰

```
å•Ÿå‹•å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host           â”‚
â”‚  ./backend/     â”‚          Container ä¸å­˜åœ¨
â”‚    uploads/     â”‚
â”‚      file.pdf   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        âœ“

å•Ÿå‹•å¾Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host           â”‚          â”‚  New Container  â”‚
â”‚  ./backend/     â”‚  â”€â”€â”€â†’    â”‚  /app/          â”‚
â”‚    uploads/     â”‚  mount   â”‚    uploads/     â”‚
â”‚      file.pdf   â”‚          â”‚      file.pdf   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        âœ“                            âœ“

çµæœ: æ–‡ä»¶é‡æ–°å¯è¨ªå•ï¼
```

## ğŸ“ é…ç½®å°ç…§

### docker-compose.yml

```yaml
services:
  backend:
    volumes:
      # èªæ³•: <ä¸»æ©Ÿè·¯å¾‘>:<å®¹å™¨è·¯å¾‘>
      - ./backend/data:/app/data           # è³‡æ–™åº«æŒä¹…åŒ–
      - ./backend/uploads:/app/uploads     # ä¸Šå‚³æ–‡ä»¶æŒä¹…åŒ–
```

### æ˜ å°„é—œä¿‚è¡¨

| ä¸»æ©Ÿè·¯å¾‘ | å®¹å™¨è·¯å¾‘ | èªªæ˜ | æŒä¹…åŒ– |
|---------|---------|------|--------|
| `./backend/data` | `/app/data` | è³‡æ–™åº«æ–‡ä»¶ | âœ… æ˜¯ |
| `./backend/uploads` | `/app/uploads` | ä¸Šå‚³æ–‡ä»¶ | âœ… æ˜¯ |
| `./backend/app` | `/app/app` | ç¨‹å¼ç¢¼ï¼ˆé–‹ç™¼ç”¨ï¼‰| âš ï¸ é–‹ç™¼æ¨¡å¼ |

## ğŸ¯ å°æ¯”ï¼šæœ‰ç„¡ Volume æ›è¼‰

### âŒ æ²’æœ‰ Volume æ›è¼‰

```
docker-compose.yml:
  backend:
    volumes: []  # æ²’æœ‰é…ç½®

å®¹å™¨å…§æ–‡ä»¶:
/app/uploads/file.pdf  â† åƒ…å­˜åœ¨å®¹å™¨å…§

åŸ·è¡Œ docker-compose down:
å®¹å™¨åˆªé™¤ â†’ æ–‡ä»¶æ¶ˆå¤± âŒ
```

### âœ… æœ‰ Volume æ›è¼‰

```
docker-compose.yml:
  backend:
    volumes:
      - ./backend/uploads:/app/uploads

å®¹å™¨å…§æ–‡ä»¶:
/app/uploads/file.pdf  â† å¯¦éš›æŒ‡å‘ ./backend/uploads/file.pdf

åŸ·è¡Œ docker-compose down:
å®¹å™¨åˆªé™¤ â†’ æ–‡ä»¶ä¿ç•™åœ¨ä¸»æ©Ÿ âœ…
```

## ğŸ” å¯¦éš›é©—è­‰

### 1. æŸ¥çœ‹æ›è¼‰é»

```bash
# æŸ¥çœ‹å®¹å™¨çš„ volume é…ç½®
docker inspect resumexlab-backend | jq '.[0].Mounts'
```

**è¼¸å‡ºç¤ºä¾‹ï¼š**

```json
[
  {
    "Type": "bind",
    "Source": "/Users/pololin/python_project/resumexlab/backend/data",
    "Destination": "/app/data",
    "Mode": "rw",
    "RW": true,
    "Propagation": "rprivate"
  },
  {
    "Type": "bind",
    "Source": "/Users/pololin/python_project/resumexlab/backend/uploads",
    "Destination": "/app/uploads",
    "Mode": "rw",
    "RW": true,
    "Propagation": "rprivate"
  }
]
```

### 2. æ¸¬è©¦åŒæ­¥

```bash
# åœ¨ä¸»æ©Ÿå‰µå»ºæ–‡ä»¶
echo "Host file" > backend/uploads/test.txt

# åœ¨å®¹å™¨å…§æŸ¥çœ‹
docker exec resumexlab-backend cat /app/uploads/test.txt
# è¼¸å‡º: Host file

# åœ¨å®¹å™¨å…§å‰µå»ºæ–‡ä»¶
docker exec resumexlab-backend sh -c 'echo "Container file" > /app/uploads/test2.txt'

# åœ¨ä¸»æ©ŸæŸ¥çœ‹
cat backend/uploads/test2.txt
# è¼¸å‡º: Container file
```

## ğŸ’¡ é—œéµæ¦‚å¿µ

### Bind Mount vs Named Volume

#### Bind Mountï¼ˆæœ¬é …ç›®ä½¿ç”¨ï¼‰

```yaml
volumes:
  - ./backend/uploads:/app/uploads  # æŒ‡å®šä¸»æ©Ÿè·¯å¾‘
```

**å„ªé»ï¼š**
- ç›´æ¥è¨ªå•ä¸»æ©Ÿæ–‡ä»¶
- æ˜“æ–¼å‚™ä»½å’ŒæŸ¥çœ‹
- é©åˆé–‹ç™¼ç’°å¢ƒ

#### Named Volume

```yaml
volumes:
  - uploads-data:/app/uploads  # Docker ç®¡ç†çš„ volume

volumes:
  uploads-data:
```

**å„ªé»ï¼š**
- Docker çµ±ä¸€ç®¡ç†
- æ›´å¥½çš„æ€§èƒ½ï¼ˆæŸäº›æƒ…æ³ï¼‰
- é©åˆç”Ÿç”¢ç’°å¢ƒ

## ğŸ“š è£œå……èªªæ˜

### æ¬Šé™å•é¡Œ

å®¹å™¨å…§çš„ç”¨æˆ¶ ID å¯èƒ½èˆ‡ä¸»æ©Ÿä¸åŒï¼Œå¯èƒ½éœ€è¦èª¿æ•´æ¬Šé™ï¼š

```bash
# æŸ¥çœ‹å®¹å™¨å…§é‹è¡Œç”¨æˆ¶
docker exec resumexlab-backend id

# èª¿æ•´ä¸»æ©Ÿç›®éŒ„æ¬Šé™ï¼ˆå¦‚éœ€è¦ï¼‰
sudo chown -R 1000:1000 backend/uploads
chmod -R 755 backend/uploads
```

### æ€§èƒ½è€ƒé‡

- **é–‹ç™¼ç’°å¢ƒ**: Bind mount æ–¹ä¾¿é–‹ç™¼ï¼Œæ€§èƒ½è¶³å¤ 
- **ç”Ÿç”¢ç’°å¢ƒ**: Named volume å¯èƒ½æœ‰æ›´å¥½æ€§èƒ½ï¼ˆLinuxï¼‰
- **Windows/Mac**: Docker Desktop ä½¿ç”¨è™›æ“¬åŒ–ï¼Œbind mount å¯èƒ½è¼ƒæ…¢

### å®‰å…¨æ€§

```yaml
volumes:
  - ./backend/uploads:/app/uploads:ro  # å”¯è®€æ›è¼‰
```

---

**ç›¸é—œæ–‡ä»¶ï¼š**
- `UPLOADS_PERSISTENCE.md` - è©³ç´°é…ç½®èªªæ˜
- `docker-compose.yml` - å¯¦éš›é…ç½®æ–‡ä»¶
- `test_uploads_persistence.sh` - è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬

**æœ€å¾Œæ›´æ–°**: 2026-01-31
